<!doctype html>  
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="description" content="">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title >Home</title>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

      <link rel="stylesheet" href="css/Footer-with-logo.css">
      <link rel="stylesheet" href="css/common.css">
      <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
      
   </head>
   <body>
        <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
                <a class="navbar-brand" href="adminHome">Maryville Car Pool</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
              
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                      <a class="nav-link" href="#">Home </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="postRide.html">Post A Ride</a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link " href="adminPreviousRides.html">Ride History</a>
                    </li>
                    <!-- <li class="nav-item">
                      <a class="nav-link " href="aboutUS.html">About Us</a>
                    </li> -->
                    <li class="nav-item active">
                      <a class="nav-link " href="dashboard.html">Dashboard <span class="sr-only">(current)</span></a>
                    </li>
                  </ul>
                  <a href="index.html"><span class="navbar-text">Signout</span> </a>
                </div>
              </nav>
              <div class="container">
                    <div class="table-wrapper">
                        <br><br><br>
                        <div class="table-title">
                            <div class="row">
                                <div class="col-sm-6">
                                    <h2>Manage <b>Users</b></h2>
                                </div>
                                <div class="col-sm-6">
                                    <a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Users</span></a>                   
                                </div>
                            </div>
                        </div>
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>State</th>
                                    <th>Phone</th>
                                    <th>isAdmin</th>
                                    <th>isUserActive</th>
                                    <th>isUserDriver</th>
                                    <th>Edit</th>
                                    <th>Delete</th>
                                </tr>
                            </thead>
                            <tbody id="userTableDetails">
                                 
                            </tbody>
                        </table>

                </div>
                <!-- Add Modal HTML -->
                <div id="addEmployeeModal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form>
                                <div class="modal-header">						
                                    <h4 class="modal-title">Add User</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                </div>
                                <div class="modal-body">					
                                    <div class="form-group">
                                        <label>Name</label>
                                        <input type="text" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>State</label>
                                        <input class="form-control" required></input>
                                    </div>
                                    <div class="form-group">
                                        <label>Phone</label>
                                        <input type="text" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>isAdmin</label>
                                        <input type="number" class="form-control" min="0" max="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>isUserActive</label>
                                        <input type="number" class="form-control" min="0" max="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>isUserDriver</label>
                                        <input type="number" class="form-control" min="0" max="1" required>
                                    </div>					
                                </div>
                                <h6 class = "text-warning">Note:- 0 indicates inactive and 1 indicates active state.</h6>
                                <div class="modal-footer">
                                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                                    <input type="submit" class="btn btn-success" id="createUser" value="Add">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Edit Modal HTML -->
                <div id="editEmployeeModal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form>
                                <div class="modal-header">						
                                    <h4 class="modal-title">Edit User</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                </div>
                                <div class="modal-body">					
                                    <div class="form-group">
                                        <label>Name</label>
                                        <input type="text" id="editName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" id="editEmail" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>state</label>
                                        <input type="text" id="editState" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Phone</label>
                                        <input type="text" id="editPhone" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>isAdmin</label>
                                        <input type="number" id="editAdmin" class="form-control" min="0" max="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>isUserActive</label>
                                        <input type="number" id="editUserActive" class="form-control" min="0" max="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>isUserDriver</label>
                                        <input type="number" id="editUserDriver" class="form-control" min="0" max="1" required>
                                    </div>						
                                </div>
                                <h6 class = "text-warning">Note:- 0 indicates inactive and 1 indicates active state.</h6>
                                <div class="modal-footer">
                                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                                    <input type="submit" class="btn btn-info" id="editUser" value="Save">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Delete Modal HTML -->
                <div id="deleteEmployeeModal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form>
                                <div class="modal-header">						
                                    <h4 class="modal-title">Delete User</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                </div>
                                <div class="modal-body">					
                                    <p>Are you sure you want to delete below user?</p>
                                    <p id="deleteUserID"></p>
                                    <p class="text-warning"><small>This action cannot be undone.</small></p>
                                </div>
                                <div class="modal-footer">
                                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                                    <input type="submit" class="btn btn-danger" id="deleteTheUser" value="Delete">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <footer id="myFooter">
                  <div class="container">
                     <div class="row">
                        <div class="col-sm-3">
                           <h5>Get started</h5>
                           <ul>
                              <li><a href="#">Home</a></li>
                              <li><a href="#">Sign up</a></li>
         
                           </ul>
                        </div>
                        <div class="col-sm-3">
                           <h5>About us</h5>
                        </div>
                        <div class="col-sm-3">
                           <h5>Support</h5>
                        </div>
                        <div class="col-sm-3 info">
                           <h5>Information</h5>
                           <p> Car Pooling System provides various rides to different locations in Kansas and Missouri State with numerous car range types.</p>
                        </div>
                     </div>
                  </div>
                  <div class="second-bar">
                     <div class="container">
                        <h2 class="logo"><a href="#">Car Pooling System</a></h2>
                        <div class="social-icons">
                           <a href="#" class="twitter"><i class="fa fa-twitter"></i></a>
                           <a href="#" class="facebook"><i class="fa fa-facebook"></i></a>
                           <a href="#" class="google"><i class="fa fa-google-plus"></i></a>
                        </div>
                     </div>
                  </div>
               </footer>

<script type="text/javascript">

function  getId(element) {
    var userDetails = JSON.parse(window.sessionStorage.getItem("UserDetailsList"));
    var tableRow = element.closest('tr').rowIndex;
    document.getElementById("editName").value = userDetails[tableRow-1].name;
    document.getElementById("editEmail").value = userDetails[tableRow-1].email;
    document.getElementById("editState").value = userDetails[tableRow-1].city;
    document.getElementById("editPhone").value = userDetails[tableRow-1].contact;
    document.getElementById("editAdmin").value = userDetails[tableRow-1].isAdmin;
    document.getElementById("editUserActive").value = userDetails[tableRow-1].isuserActive;
    document.getElementById("editUserDriver").value = userDetails[tableRow-1].isuserDriver;
}

function  getDeleteId(element) {
    var userDetails = JSON.parse(window.sessionStorage.getItem("UserDetailsList"));
    var tableRow = element.closest('tr').rowIndex;
    document.getElementById("deleteUserID").innerHTML = userDetails[tableRow-1].email;
}

$('#editUser').click(function(){
    var name = document.getElementById("editName").value;
    var email = document.getElementById("editEmail").value;
    var state = document.getElementById("editState").value;
    var phone = document.getElementById("editPhone").value;
    var admin = document.getElementById("editAdmin").value;
    var user = document.getElementById("editUserActive").value;
    var driver = document.getElementById("editUserDriver").value;

    var userDetails = JSON.parse(window.sessionStorage.getItem("UserDetailsList"));
    var getUserDetail;
    for (i = 0; i < userDetails.length; i++) {
        if (userDetails[i].email === email) {
            getUserDetail = userDetails[i];
        }
    }
    if (getUserDetail === undefined) {
        alert("You are trying to change your Email. In this case please delete the user and try to add user again with new Email. You are not allowed to changes user's Email address.")
    } else {
    if (name != getUserDetail.name || state != getUserDetail.city || phone != getUserDetail.contact || admin != getUserDetail.isAdmin || user != getUserDetail.isuserActive || driver != getUserDetail.isuserDriver) {
    console.log(email);
    $.ajax({
    type: "POST",
    data:{email:email,name:name,contact:phone,city:state,isAdmin:admin,isuserActive:user,isuserDriver:driver},
    url: "updateUser.php",
    success: function(response) {
        console.log(response)
        location.reload();
    }
    });
    } else {
        console.log("Nothing to Update")
    }
    }   
});

</script>

<script type="text/javascript">
    var userLoggedIn = window.sessionStorage.getItem('adminID');
    console.log(userLoggedIn);
    if(userLoggedIn === "" || !userLoggedIn) {
        window.location.href = "index.html";
    }

    $(document).ready(function(){
    $.ajax({
    type: "POST",
    url: "userList.php",
    dataType:"json",
    success: function(response) {
        window.sessionStorage.setItem("UserDetailsList", JSON.stringify(response));
        var tempList = '';
        for (i = 0; i < response.length; i++) {
        tempList +=     '<tr>'+
                                    '<td>'+response[i].name+'</td>'+
                                    '<td>'+response[i].email+'</td>'+
                                    '<td>'+response[i].city+'</td>'+
                                    '<td>'+response[i].contact+'</td>'+
                                    '<td>'+response[i].isAdmin+'</td>'+
                                    '<td>'+response[i].isuserActive+'</td>'+
                                    '<td>'+response[i].isuserDriver+'</td>'+
                                    '<td>'+
                                        '<a href="#editEmployeeModal" class="edit" data-toggle="modal" onclick="getId(this)"><i class="material-icons" data-toggle="tooltip" title="Edit">Edit</i></a>'+
                                    '</td>'+
                                    '<td>'+
                                        '<a href="#deleteEmployeeModal" class="delete" data-toggle="modal" onclick="getDeleteId(this)"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>'+
                                    '</td>'+
                        '</tr>'
        }
$('#userTableDetails').html(tempList);
    }
});

// $('#editEmployeeModal').on('click', function(e){
// var id = $(e.target).closest('tr').find(".id").html();
// console.log("Getting the row ID",id)
// });

$("#deleteTheUser").click(function(){
    var deleteUserEmail = document.getElementById("deleteUserID").innerHTML;
    alert(deleteUserEmail);
    $.ajax({
    type: "POST",
    data:{userID:deleteUserEmail},
    url: "deleteUser.php",
    success: function(response) {
        alert(response)
        location.reload();
    }
    });
});


                    // Activate tooltip
                    $('[data-toggle="tooltip"]').tooltip();
                    
                    // Select/Deselect checkboxes
                    var checkbox = $('table tbody input[type="checkbox"]');
                    $("#selectAll").click(function(){
                        if(this.checked){
                            checkbox.each(function(){
                                this.checked = true;                        
                            });
                        } else{
                            checkbox.each(function(){
                                this.checked = false;                        
                            });
                        } 
                    });
                    checkbox.click(function(){
                        if(!this.checked){
                            $("#selectAll").prop("checked", false);
                        }
                    });
                });
                </script>
       </body>
</html>